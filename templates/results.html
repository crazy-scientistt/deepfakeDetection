<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detection Results</title>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #07f4f4;
      --secondary-color: #18dcff;
      --dark-bg: #0a1929;
      --card-bg: rgba(12, 25, 44, 0.9);
      --light-text: #f0f8ff;
      --highlight: #00ffcc;
      --border-color: rgba(7, 244, 244, 0.3);
      --success-color: #00ff88;
      --danger-color: #ff3e6a;
    }

    body {
      margin: 0;
      font-family: 'Inter', 'Segoe UI', 'Roboto', sans-serif;
      background-color: var(--dark-bg);
      color: var(--light-text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Improved Video Background */
    .background-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      overflow: hidden;
    }

    .background-video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      transform: translateX(-50%) translateY(-50%);
      filter: blur(8px) brightness(0.4);
    }

    .background-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 0, 30, 0.8) 0%, rgba(0, 20, 40, 0.9) 100%);
    }

    /* Modern Navbar */
    .navbar {
      background: rgba(5, 15, 30, 0.85);
      backdrop-filter: blur(10px);
      padding: 15px 5%;
      border-bottom: 1px solid var(--border-color);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      z-index: 1000;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar.shrink {
      padding: 8px 5%;
      background: rgba(5, 15, 30, 0.95);
    }

    .navbar-brand {
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      color: var(--primary-color);
      text-shadow: 0 0 15px rgba(7, 244, 244, 0.5);
      text-decoration: none;
    }

    .navbar-brand span {
      color: var(--highlight);
    }

    .navbar-links {
      display: flex;
      gap: 30px;
    }

    .navbar-links a {
      color: var(--light-text);
      text-decoration: none;
      font-weight: 500;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .navbar-links a:hover {
      color: var(--primary-color);
      text-shadow: 0 0 8px rgba(7, 244, 244, 0.3);
    }

    /* Main Content Styling */
    .content {
      margin-top: 80px;
      padding: 40px 5%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .page-title {
      font-size: 3rem;
      font-weight: 800;
      margin-bottom: 30px;
      text-align: center;
      background: linear-gradient(to right, var(--primary-color), var(--highlight));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 20px rgba(7, 244, 244, 0.3);
    }

    /* Improved Summary Box */
    .summary-box {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 30px;
      max-width: 1000px;
      width: 100%;
      margin-bottom: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }

    .summary-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .summary-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .summary-label {
      font-size: 1rem;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .summary-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .summary-prediction {
      text-align: center;
      font-size: 2rem;
      font-weight: 800;
      margin: 20px 0;
      padding: 15px;
      background: linear-gradient(to right, rgba(0, 255, 204, 0.1), rgba(7, 244, 244, 0.1));
      border-radius: 10px;
      border-left: 4px solid var(--primary-color);
    }

    /* Charts Container */
    .charts-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      max-width: 1200px;
      width: 100%;
      margin-bottom: 40px;
    }

    .chart-box {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(8px);
    }

    /* Frame Section */
    .frame-section {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 30px;
      max-width: 1200px;
      width: 100%;
      margin-bottom: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .section-title {
      color: var(--primary-color);
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 30px;
      text-align: center;
      letter-spacing: -0.5px;
    }

    .frames-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 25px;
    }

    .frame-card {
      background: rgba(15, 30, 50, 0.8);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .frame-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    .frame-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-bottom: 1px solid var(--border-color);
    }

    .frame-info {
      padding: 15px;
    }

    .frame-info p {
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .frame-info span {
      font-weight: 600;
      color: var(--primary-color);
    }

    /* Download Buttons */
    .download-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: center;
    }

    .download-btn {
      background: linear-gradient(to right, var(--primary-color), var(--highlight));
      color: var(--dark-bg);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(7, 244, 244, 0.3);
    }

    .download-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(7, 244, 244, 0.4);
    }

    .download-btn:active {
      transform: translateY(1px);
    }

    .download-btn i {
      font-size: 18px;
    }

    /* Improved Footer */
    .footer {
      background: linear-gradient(to right, rgba(7, 244, 244, 0.1), rgba(0, 255, 204, 0.1));
      padding: 50px 5%;
      color: var(--light-text);
      margin-top: 50px;
      border-top: 1px solid var(--border-color);
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-left h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .footer-input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-color);
      padding: 12px 15px;
      border-radius: 8px;
      width: 100%;
      margin-bottom: 15px;
      color: var(--light-text);
      outline: none;
      transition: all 0.3s ease;
    }

    .footer-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(7, 244, 244, 0.2);
    }

    .subscribe-btn {
      background: var(--primary-color);
      color: var(--dark-bg);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .subscribe-btn:hover {
      background: var(--highlight);
      transform: translateY(-2px);
    }

    .subscribe-btn.clicked {
      background: var(--success-color);
    }

    .footer-right h1 {
      font-size: 2rem;
      font-weight: 800;
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    .footer-right p {
      color: var(--light-text);
      opacity: 0.8;
      line-height: 1.6;
    }

    .footer-bottom {
      text-align: center;
      padding: 20px 0;
      margin-top: 40px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9rem;
      opacity: 0.7;
    }

    .footer-bottom a {
      color: var(--primary-color);
      text-decoration: none;
    }

    
/* Feedback Modal Styles */
#feedbackModal {
  transition: opacity 0.3s ease;
}

/* Star Rating Container */
.star-rating {
  user-select: none;
  display: flex;
  gap: 8px;
}

/* Star Label Styles */
.star-label {
  cursor: pointer;
  position: relative;
}
/* Star icon base style */
.star-label .fa-star {
  transition: color 0.2s ease;
  color: #9CA3AF; /* gray */
  font-size: 1.5rem;
}

/* Filled stars (on hover or selected) */
.star-label.filled .fa-star {
  color: #facc15; /* yellow */
}

#overall-prediction {
  font-size: 24px;  /* Adjust size as needed */
  font-weight: bold; /* Optional: make it bold */
}.feedback-submit-btn {
  background-color: var(--neon-green);
  color: rgb(255, 255, 255);
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  z-index: 10;
}

.feedback-submit-btn:hover {
  background-color:var(--primary-blue);
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(7, 244, 188, 0.4);
  opacity: 1 !important; /* Override any opacity settings on hover */
}

/* If you want to include an icon */
.feedback-submit-btn i {
  font-size: 18px;
}

    .skip-btn {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--light-text);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .skip-btn:hover {
      background: var(--primary-color);
    }

    .submit-btn {
      background: var(--primary-color);
      color: var(--dark-bg);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .submit-btn:hover {
      background: var(--highlight);
      transform: translateY(-2px);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .page-title {
        font-size: 2.2rem;
      }
      
      .summary-value {
        font-size: 1.5rem;
      }
      
      .summary-prediction {
        font-size: 1.5rem;
      }
      
      .charts-container {
        grid-template-columns: 1fr;
      }
      
      .footer-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .navbar {
        flex-direction: column;
        gap: 10px;
      }
      
      .download-buttons {
        flex-direction: column;
        width: 100%;
      }
      
      .download-btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <!-- Enhanced Background -->
  <div class="background-container">
    <video autoplay muted loop class="background-video">
      <source src="https://videos.pexels.com/video-files/7385122/7385122-uhd_2560_1440_30fps.mp4" type="video/mp4">
    </video>
    <div class="background-overlay"></div>
  </div>

  <!-- Modern Navbar -->
  <header class="navbar">
    <a href="http://127.0.0.1:8000/" class="navbar-brand">Deep<span>Deception</span></a>
    <nav class="navbar-links">
      <a href="http://127.0.0.1:8000/">Home</a>
      <a href="#Subscribe">Subscribe</a>
      <a href="#FeedBack">Feedback</a>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="content">
    <h1 class="page-title">Your Deepfake Scan Results</h1>

    <!-- Summary Box -->
    <div class="summary-box">
      <div class="summary-content">
        <div class="summary-item">
          <div class="summary-label">Authenticity Check</div>
          <div class="summary-value" id="overall-label">{{ overall_label }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Fake Frames</div>
          <div class="summary-value" id="fake-count">{{ fake_count }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Real Frames</div>
          <div class="summary-value" id="real-count">{{ real_count }}</div>
        </div>
      </div>
      
      <div class="summary-prediction" id="overall-prediction">{{ overall_prediction }}</div>
      
      <div class="download-buttons">
        <button class="download-btn" onclick="generatePDF()">
          <i class="fas fa-file-pdf"></i> Download PDF Report
        </button>
        <button class="download-btn" onclick="generateCSV()">
          <i class="fas fa-file-csv"></i> Download Excel Data
        </button>
      </div>
    </div>

    <!-- Charts Container -->
    <div class="charts-container">
      <div class="chart-box">
        <div id="chart"></div>
      </div>
      <div class="chart-box">
        <div id="radialChart"></div>
      </div>
      <div class="chart-box">
        <div id="modelPerformanceChart"></div>
      </div>
    </div>

    <!-- Frame Details Section -->
    <div class="frame-section">
      <h2 class="section-title">Frame-by-Frame Analysis</h2>
      <div class="frames-grid">
        {% for filename, prediction, confidence in results %}
        <div class="frame-card">
          <img src="media/{{ MEDIA_URL }}frames/{{ filename }}" alt="{{ filename }}">
          <div class="frame-info">
            <p>Frame Name: <span>{{ filename }}</span></p>
            <p>Detected As: <span>{{ prediction }}</span></p>
            <p>Confidence Score: <span>{{ confidence }}</span></p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
    
  <!-- Improved Footer -->
  <section id="Subscribe" class="footer">
    <div class="footer-container">
      <div class="footer-left">
        <h2>Subscribe to Newsletter</h2>
        <input type="email" id="email-input" placeholder="Your email address" required class="footer-input">
        <button type="button" class="subscribe-btn" id="subscribe-btn" onclick="subscribe()">Subscribe</button>
      </div>

      <div class="footer-right">
        <h1>DeepDeception</h1>
        <p>Stay informed about the latest in deepfake detection and cyber security with our cutting-edge technology and research.</p>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 DeepDeception. All rights reserved.
        <a href="#privacy">Privacy Policy</a> |
        <a href="#terms">Terms of Service</a>
      </p>
    </div>
  </section>

  
<!-- Feedback Modal -->
<div id="feedbackModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full border border-neon-green">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold text-neon-green">Share Your Feedback</h3>
      <button id="closeFeedback" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="feedbackForm">
      <div class="star-rating flex justify-center gap-2">
        {% for i in "12345" %}
          <label class="star-label" data-rating="{{ i }}">
            <i class="fa fa-star text-2xl text-gray-400"></i>
          </label>
        {% endfor %}
      </div>
      <input type="hidden" name="rating" id="ratingInput">
      
      
      <div class="mb-4">
        <label class="block text-gray-300 mb-2">Your feedback (optional)</label>
        <textarea name="comment" rows="3" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600 focus:border-neon-green focus:ring-neon-green"></textarea>
      </div>
      
      <div class="flex justify-between">
        <button type="button" id="skipFeedback" class="px-4 py-2 rounded border border-gray-600 text-gray-300 hover:bg-gray-700 transition">
          Skip
          <button 
  type="submit" 
  class="feedback-submit-btn px-4 py-2 bg-[#07f4bc] text-black rounded hover:opacity-90 transition-all duration-300 flex items-center justify-center gap-2"
>
  Submit Feedback
</button>
      </div>
    </form>
  </div>
</div>

<script>

    // Helper function to convert image URL to base64
    async function getBase64ImageFromURL(url) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.readAsDataURL(blob); 
          reader.onloadend = () => resolve(reader.result);
        });
      } catch (error) {
        console.error('Error loading image:', error);
        return null;
      }
    }

    // Helper function to convert hex colors to RGB for jsPDF
    function hexToRgb(hex) {
      // Handle rgba format
      if (hex.startsWith('rgba')) {
          const parts = hex.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d.]+)\)/);
          if (parts) {
              return {
                  r: parseInt(parts[1], 10),
                  g: parseInt(parts[2], 10),
                  b: parseInt(parts[3], 10)
              };
          }
          return { r: 0, g: 0, b: 0 };
      }
      
      // Remove # if present
      hex = hex.replace('#', '');
      
      // Handle shorthand hex
      if (hex.length === 3) {
          hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
      }
      
      return {
          r: parseInt(hex.substring(0, 2), 16),
          g: parseInt(hex.substring(2, 4), 16),
          b: parseInt(hex.substring(4, 6), 16)
      };
    }

    async function generatePDF() {
      try {
        // Show loading state
        const btn = document.querySelector('.download-btn');
        const originalBtnContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
        btn.disabled = true;

        if (!window.jspdf) throw new Error('jsPDF not loaded');
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Set document metadata
        doc.setProperties({
            title: 'Deepfake Analysis Report',
            subject: 'Detection Results',
            creator: 'DeepDeception'
        });

        // Color scheme matching your HTML theme
        const colors = {
            primary: '#07f4f4',         // Primary color (cyan/teal)
            secondary: '#00ffcc',       // Highlight color
            darkBg: '#0a1929',          // Dark background
            cardBg: '#0c192c',          // Card background
            lightText: '#f0f8ff',       // Light text
            headerBg: 'rgba(5, 15, 30, 0.9)', // Header background
            footerBg: 'rgba(7, 244, 244, 0.1)', // Footer background
            borderColor: 'rgba(7, 244, 244, 0.3)', // Border color
            successColor: '#00ff88',    // Success color
            dangerColor: '#ff3e6a',     // Danger/fake color
            rowEven: '#0f1e32',         // Even row background
            rowOdd: '#0a1929'           // Odd row background
        };

        // ========== HEADER SECTION ==========
        // Header background
        doc.setFillColor(hexToRgb(colors.headerBg).r, hexToRgb(colors.headerBg).g, hexToRgb(colors.headerBg).b);
        doc.rect(0, 0, 210, 40, 'F');
        
        // Logo and title
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(20);
        doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
        doc.text('Deepfake Analysis Report', 105, 20, { align: 'center' });
        
        // Report details
        doc.setFontSize(10);
        doc.setTextColor(hexToRgb(colors.lightText).r, hexToRgb(colors.lightText).g, hexToRgb(colors.lightText).b);
        doc.text(`Report ID: ${Math.floor(Math.random() * 1000)}`, 15, 30);
        doc.text(`Generated: ${new Date().toLocaleDateString()}`, 15, 35);
        
        // ========== SUMMARY SECTION ==========
        doc.setFontSize(16);
        doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
        doc.text('Analysis Summary', 15, 50);
        
        doc.setFontSize(12);
        doc.setTextColor(hexToRgb(colors.lightText).r, hexToRgb(colors.lightText).g, hexToRgb(colors.lightText).b);
        
        // Summary table
        const summaryData = [
            ['Authenticity Check', document.getElementById('overall-label')?.textContent || 'N/A'],
            ['Prediction', document.getElementById('overall-prediction')?.textContent || 'N/A'],
            ['Fake Frames', document.getElementById('fake-count')?.textContent || '0'],
            ['Real Frames', document.getElementById('real-count')?.textContent || '0']
        ];
        
        // Draw summary table with alternating colors
        doc.setFont('helvetica', 'normal');
        summaryData.forEach((row, i) => {
            const y = 60 + (i * 10);
            // Alternate row colors
            const bgColor = i % 2 === 0 ? colors.rowOdd : colors.rowEven;
            doc.setFillColor(hexToRgb(bgColor).r, hexToRgb(bgColor).g, hexToRgb(bgColor).b);
            doc.rect(15, y - 5, 180, 10, 'F');
            doc.text(row[0], 20, y);
            
            // Use different color for values based on content (optional)
            let valueColor = colors.lightText;
            if(row[0] === 'Prediction') {
                const predictionText = row[1].toLowerCase();
                valueColor = predictionText.includes('fake') ? colors.dangerColor : colors.successColor;
            }
            
            doc.setTextColor(hexToRgb(valueColor).r, hexToRgb(valueColor).g, hexToRgb(valueColor).b);
            doc.text(row[1], 100, y);
            doc.setTextColor(hexToRgb(colors.lightText).r, hexToRgb(colors.lightText).g, hexToRgb(colors.lightText).b);
        });
        
        // ========== FRAME ANALYSIS SECTION ==========
        doc.addPage();
        doc.setFillColor(hexToRgb(colors.headerBg).r, hexToRgb(colors.headerBg).g, hexToRgb(colors.headerBg).b);
        doc.rect(0, 0, 210, 40, 'F');
        
        doc.setFontSize(16);
        doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
        doc.text('Frame-by-Frame Analysis', 105, 20, { align: 'center' });
        
        // Table headers
        doc.setFillColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b, 0.2);
        doc.rect(15, 45, 180, 10, 'F');
        doc.setFontSize(12);
        doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
        doc.text('No.', 20, 52);
        doc.text('Filename', 50, 52);
        doc.text('Prediction', 120, 52);
        doc.text('Confidence', 160, 52);
        
        // Frame data with images
        const frameCards = document.querySelectorAll('.frame-card');
        let yPos = 55;
        
        for (let index = 0; index < frameCards.length; index++) {
            const card = frameCards[index];
            
            if (yPos > 200) { // Reduced threshold to accommodate images
                doc.addPage();
                // Add header to new page
                doc.setFillColor(hexToRgb(colors.headerBg).r, hexToRgb(colors.headerBg).g, hexToRgb(colors.headerBg).b);
                doc.rect(0, 0, 210, 40, 'F');
                doc.setFontSize(16);
                doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
                doc.text('Frame-by-Frame Analysis', 105, 20, { align: 'center' });
                
                // Redraw headers on new page
                doc.setFillColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b, 0.2);
                doc.rect(15, 45, 180, 10, 'F');
                doc.setFontSize(12);
                doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
                doc.text('No.', 20, 52);
                doc.text('Filename', 50, 52);
                doc.text('Prediction', 120, 52);
                doc.text('Confidence', 160, 52);
                yPos = 55;
            }

            const spans = card.querySelectorAll('span');
            const imgElement = card.querySelector('img');
            const imgSrc = imgElement ? imgElement.src : null;
            
            // Draw image (50px height)
            if (imgSrc) {
                try {
                    const imgData = await getBase64ImageFromURL(imgSrc);
                    if (imgData) {
                        doc.addImage(imgData, 'JPEG', 15, yPos, 40, 30); // Smaller image (40x30)
                    }
                } catch (error) {
                    console.error('Error adding image:', error);
                }
            }
            
            // Draw frame info to the right of the image
            const rowData = [
                (index + 1).toString(),
                spans[0]?.textContent || 'N/A',
                spans[1]?.textContent || 'N/A',
                spans[2]?.textContent || 'N/A'
            ];
            
            // Alternate row colors
            const bgColor = index % 2 === 0 ? colors.rowOdd : colors.rowEven;
            doc.setFillColor(hexToRgb(bgColor).r, hexToRgb(bgColor).g, hexToRgb(bgColor).b);
            doc.rect(60, yPos, 135, 30, 'F'); // Adjusted rectangle position
            
            doc.setTextColor(hexToRgb(colors.lightText).r, hexToRgb(colors.lightText).g, hexToRgb(colors.lightText).b);
            doc.text(rowData[0], 65, yPos + 10);
            doc.text(rowData[1], 80, yPos + 10);
            
            // Use color based on prediction (fake/real)
            const predictionText = rowData[2].toLowerCase();
            const predictionColor = predictionText.includes('fake') ? colors.dangerColor : colors.successColor;
            doc.setTextColor(hexToRgb(predictionColor).r, hexToRgb(predictionColor).g, hexToRgb(predictionColor).b);
            doc.text(rowData[2], 120, yPos + 10);
            doc.text(rowData[3], 160, yPos + 10);
            
            yPos += 35; // Increased spacing for image rows
        }
        
        // ========== FOOTER SECTION ==========
        const pageCount = doc.internal.getNumberOfPages();
        
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            
            // Footer background
            doc.setFillColor(hexToRgb(colors.footerBg).r, hexToRgb(colors.footerBg).g, hexToRgb(colors.footerBg).b);
            doc.rect(0, 287, 210, 10, 'F');
            
            // Footer text
            doc.setFontSize(8);
            doc.setTextColor(hexToRgb(colors.primary).r, hexToRgb(colors.primary).g, hexToRgb(colors.primary).b);
            doc.text(`Page ${i} of ${pageCount}`, 105, 292, { align: 'center' });
            doc.text('DeepDeception - Confidential Report', 15, 292);
            doc.text(new Date().toLocaleDateString(), 180, 292, { align: 'right' });
        }
        
        // Save the PDF
        doc.save('deepfake_analysis_report.pdf');
        
        // Restore button state
        btn.innerHTML = originalBtnContent;
        btn.disabled = false;
      } catch (error) {
        console.error('PDF generation failed:', error);
        alert('Failed to generate PDF. Please check console for details.');
        
        // Restore button state even on error
        const btn = document.querySelector('.download-btn');
        btn.innerHTML = '<i class="fas fa-file-pdf"></i> Download PDF Report';
        btn.disabled = false;
      }
    }

  
  
    function generateCSV() {
      try {
        if (!checkLibraries()) {
          alert('Required libraries not loaded. Please refresh the page.');
          return;
        }
  
        const data = [
          ['Deepfake Analysis Report', '', '', ''],
          ['Generated:', new Date().toLocaleString(), '', ''],
          ['', '', '', ''],
          ['Summary', '', '', ''],
          ['Authenticity Check', document.getElementById('overall-label')?.textContent || 'N/A'],
          ['Overall Prediction', document.getElementById('overall-prediction')?.textContent || 'N/A'],
          ['Fake Frames', document.getElementById('fake-count')?.textContent || '0'],
          ['Real Frames', document.getElementById('real-count')?.textContent || '0'],
          ['', '', '', ''],
          ['Frame Analysis', '', '', ''],
          ['No.', 'Filename', 'Prediction', 'Confidence']
        ];
  
        // Add frame data
        document.querySelectorAll('.frame-card').forEach((card, index) => {
          const spans = card.querySelectorAll('span');
          data.push([
            index + 1,
            spans[0]?.textContent || 'N/A',
            spans[1]?.textContent || 'N/A',
            spans[2]?.textContent || 'N/A'
          ]);
        });
  
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Analysis");
        
        // Generate and download
        XLSX.writeFile(wb, "deepfake_analysis.xlsx");
      } catch (error) {
        console.error('CSV generation failed:', error);
        alert('Failed to generate CSV. Please check console for details.');
      }
    }
  </script>
   
    
  <script>
    window.onscroll = function() {shrinkNavbar()};
    
    var navbar = document.querySelector('.navbar');  // Select the navbar
    
    // Function to change navbar style when scrolling
    function shrinkNavbar() {
        if (window.scrollY > 50) {  // If the user scrolls down 50px
            navbar.classList.add("shrink");  // Add 'shrink' class to reduce padding/height
        } else {
            navbar.classList.remove("shrink");  // Remove 'shrink' class when not scrolling
        }
    }
    </script>
  
  
  
  
  
  
    <script>
      // Parse backend-rendered counts safely
      const realCount = parseInt("{{ real_count|default:'0' }}");
      const fakeCount = parseInt("{{ fake_count|default:'0' }}");
  
    
  
      // Total Real vs Fake Frames Bar Chart
      const chartOptions = {
        chart: {
          type: 'bar',
          height: 350,
          background: 'transparent'
        },
        series: [{
          name: 'Frame Count',
          data: [realCount, fakeCount]
        }],
        xaxis: {
          categories: ['Real Frames', 'Fake Frames'],
          labels: { style: { colors: '#fff' } },
          title: { text: 'Frame Type', style: { color: '#ccc' } }
        },
        yaxis: {
          labels: { style: { colors: '#fff' } },
          title: { text: 'Count', style: { color: '#ccc' } }
        },
        colors: ['#07f4bc', '#ff4d4d'],
        title: {
          text: 'Total Real vs Fake Frames',
          align: 'center',
          style: { color: '#07f4bc', fontSize: '18px' }
        },
        dataLabels: { enabled: true },
        legend: { labels: { colors: '#fff' } }
      };
  
      const chart = new ApexCharts(document.querySelector("#chart"), chartOptions);
      chart.render();
  
      // Updated Model Performance Metrics Pie Chart
const performanceChartOptions = {
  chart: {
    type: 'pie',
    height: '100%', // Responsive height
    width: '100%',  // Responsive width
    background: 'transparent'
  },
  series: [realCount, fakeCount],
  labels: ['Real Frame Accuracy', 'Fake Frame Accuracy'],
  colors: ['#07f4bc', '#ff4d4d'],
  title: {
    text: 'Model Performance Metrics',
    align: 'center',
    style: { 
      color: '#07f4bc', 
      fontSize: '18px',
      fontFamily: 'Inter, sans-serif'
    },
    margin: 15
  },
  dataLabels: { 
    enabled: true,
    style: {
      fontSize: '14px',
      fontWeight: 'bold'
    }
  },
  legend: { 
    position: 'bottom',
    labels: { 
      colors: '#fff',
      useSeriesColors: false
    }
  },
  responsive: [{
    breakpoint: 768,
    options: {
      chart: {
        height: 350
      },
      legend: {
        position: 'bottom'
      }
    }
  }]
};
  
      const performanceChart = new ApexCharts(document.querySelector("#modelPerformanceChart"), performanceChartOptions);
      performanceChart.render();
  
      // Radial Chart for Real Percentage
      const total = realCount + fakeCount;
      const realPercentage = total > 0 ? ((realCount / total) * 100).toFixed(2) : 0;
  
      const radialOptions = {
        chart: {
          height: 350,
          type: "radialBar",
          background: "transparent"
        },
        series: [parseFloat(realPercentage)],
        colors: ["#07f4bc"],
        plotOptions: {
          radialBar: {
            hollow: {
              size: "60%"
            },
            dataLabels: {
              name: {
                show: true,
                color: "#ccc",
                fontSize: "16px"
              },
              value: {
                color: "#fff",
                fontSize: "22px",
                fontWeight: "bold",
                formatter: function (val) {
                  return val + "%";
                }
              }
            }
          }
        },
        labels: ["Real Confidence"],
        title: {
          text: "Authenticity Score",
          align: "center",
          style: {
            color: "#07f4bc",
            fontSize: "18px"
          }
        }
      };
  
      const radialChart = new ApexCharts(document.querySelector("#radialChart"), radialOptions);
      radialChart.render();
  </script>
  
  <script>
    function subscribe() {
        var email = document.getElementById('email-input').value;
        var subscribeBtn = document.getElementById('subscribe-btn');
  
        // Check if the email input is not empty and is valid
        if (email && validateEmail(email)) {
            // Send the email to the backend via AJAX (using fetch API)
            fetch('/newsletter/submit-email/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',  // Send JSON data
                },
                body: JSON.stringify({ email: email })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Show success message
                    alert('Thank you for subscribing!');
  
                    // Clear the input field after subscription
                    document.getElementById('email-input').value = '';
  
                    // Disable the button to prevent further clicks
                    subscribeBtn.disabled = true;
  
                    // Change the button text to 'Subscribed'
                    subscribeBtn.innerText = 'Subscribed';
  
                    // Add the 'clicked' class to change button appearance
                    subscribeBtn.classList.add('clicked');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        } else {
            alert('Please enter a valid email.');
        }
    }
  
    // Email validation function
    function validateEmail(email) {
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        return emailPattern.test(email);  // returns true if valid, false otherwise
    }
  
    // Re-enable the subscribe button when the user enters a new email
    document.getElementById('email-input').addEventListener('input', function() {
        var subscribeBtn = document.getElementById('subscribe-btn');
        if (document.getElementById('email-input').value) {
            subscribeBtn.disabled = false;
            subscribeBtn.innerText = 'Subscribe';
            subscribeBtn.classList.remove('clicked');  // Remove the 'clicked' class when re-enabling
        }
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const feedbackModal = document.getElementById('feedbackModal');
      const closeFeedback = document.getElementById('closeFeedback');
      const skipFeedback = document.getElementById('skipFeedback');
      const feedbackForm = document.getElementById('feedbackForm');
      
      const starLabels = document.querySelectorAll('.star-label');
  const ratingInput = document.getElementById('ratingInput'); // hidden input
  let currentRating = 0;
  
  starLabels.forEach((label, index) => {
    const rating = index + 1;
  
    label.addEventListener('mouseenter', () => {
      fillStars(rating);
    });
  
    label.addEventListener('mouseleave', () => {
      fillStars(currentRating);
    });
  
    label.addEventListener('click', () => {
      currentRating = rating;
      ratingInput.value = currentRating;
      fillStars(currentRating);
    });
  });
  
  function fillStars(upTo) {
    starLabels.forEach((label, index) => {
      if (index < upTo) {
        label.classList.add('filled');
      } else {
        label.classList.remove('filled');
      }
    });
  }
  
      // Show feedback modal after 30 seconds or when clicking feedback link
      setTimeout(() => {
  if(!localStorage.getItem('feedbackSubmitted') && !localStorage.getItem('feedbackSkipped')) {
    feedbackModal.classList.remove('hidden');
  }
}, 5);

      
      // Navbar feedback link
      document.querySelector('a[href="#FeedBack"]').addEventListener('click', (e) => {
        e.preventDefault();
        feedbackModal.classList.remove('hidden');
      });
      
      // Close modal handlers
      closeFeedback.addEventListener('click', () => {
        feedbackModal.classList.add('hidden');
        resetStars();
        currentRating = 0;
        feedbackForm.reset();
      });
      
      skipFeedback.addEventListener('click', () => {
        feedbackModal.classList.add('hidden');
        localStorage.setItem('feedbackSkipped', 'true');
        resetStars();
        currentRating = 0;
        feedbackForm.reset();
      });
      
      // Form submission
  feedbackForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!currentRating) {
      alert('Please select a rating');
      return;
    }
    
    const formData = new FormData(feedbackForm);
    const data = {
      rating: currentRating,
      comment: formData.get('comment'),
      page_url: window.location.href
    };
    
    try {
      const response = await fetch('/api/feedback/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken'),
        },
        body: JSON.stringify(data)
      });
      
      const responseData = await response.json(); // Parse the response
      
      if (response.ok) {
        // Only show success message if the response is truly successful
        alert('Thank you for your feedback!');
        localStorage.setItem('feedbackSubmitted', 'true');
        feedbackModal.classList.add('hidden');
        resetStars();
        currentRating = 0;
        feedbackForm.reset();
      }
      
      else {
        // Show the error message from server if available, otherwise generic message
        const errorMsg = responseData.message || 'Failed to submit feedback';
        throw new Error(errorMsg);
      }
    }
    
    catch (error) {
      console.error('Feedback submission error:', error);
      // Only show error alert if we haven't already shown a success message
      if (!feedbackModal.classList.contains('hidden')) {
        alert(error.message || 'There was an error submitting your feedback. Please try again later.');
      }
    }
  });
      
      // Helper function to get CSRF token
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }
    });
    </script>
  
  </body>
  </html>
  
